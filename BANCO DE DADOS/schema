
CREATE TABLE tb_dim_equipe
(
  co_seq_dim_equipe         INT     NOT NULL GENERATED ALWAYS AS IDENTITY,
  nu_ine                    VARCHAR NOT NULL,
  no_equipe                 VARCHAR NOT NULL,
  co_seq_dim_unidade_saude  INT     NOT NULL,
  co_seq_fat_unidade_equipe INT     NOT NULL,
  PRIMARY KEY (co_seq_dim_equipe)
);

COMMENT ON TABLE tb_dim_equipe IS 'armazena dados referentes a equipe';

COMMENT ON COLUMN tb_dim_equipe.nu_ine IS 'ine da equipe';

COMMENT ON COLUMN tb_dim_equipe.no_equipe IS 'nome da equipe';

CREATE TABLE tb_dim_profissional
(
  co_seq_dim_profissional INT     NOT NULL GENERATED ALWAYS AS IDENTITY,
  nu_cns                  VARCHAR NOT NULL,
  nome_prof               VARCHAR NOT NULL,
  cpf_prof                VARCHAR NOT NULL,
  PRIMARY KEY (co_seq_dim_profissional)
);

COMMENT ON TABLE tb_dim_profissional IS 'armazena dados referentes ao profissional';

COMMENT ON COLUMN tb_dim_profissional.co_seq_dim_profissional IS 'PK profissional';

COMMENT ON COLUMN tb_dim_profissional.nu_cns IS 'n√∫mero do cns do profissional';

COMMENT ON COLUMN tb_dim_profissional.nome_prof IS 'nome do profissional';

COMMENT ON COLUMN tb_dim_profissional.cpf_prof IS 'cpf do profissional';

CREATE TABLE tb_dim_unidade
(
  co_seq_dim_unidade_saude INT NOT NULL GENERATED ALWAYS AS IDENTITY,
  co_seq_dim_equipe        INT NOT NULL,
  PRIMARY KEY (co_seq_dim_unidade_saude)
);

COMMENT ON TABLE tb_dim_unidade IS 'armazena dados referentes a unidade de saude';

CREATE TABLE tb_fat_equipe_profissional
(
  co_seq_tb_fat_equipe_profissional INT NOT NULL GENERATED ALWAYS AS IDENTITY,
  co_seq_dim_profissional           INT NOT NULL,
  co_seq_dim_equipe                 INT NOT NULL,
  cmpt_cnes                         INT NOT NULL,
  PRIMARY KEY (co_seq_tb_fat_equipe_profissional)
);

COMMENT ON TABLE tb_fat_equipe_profissional IS 'relacionamento entre profissional e equipe';

COMMENT ON COLUMN tb_fat_equipe_profissional.co_seq_dim_profissional IS 'FK dim_profissional';

COMMENT ON COLUMN tb_fat_equipe_profissional.co_seq_dim_equipe IS 'FK dim_equipe';

COMMENT ON COLUMN tb_fat_equipe_profissional.cmpt_cnes IS 'Competencia do CNES';

CREATE TABLE tb_fat_unidade_equipe
(
  co_seq_fat_unidade_equipe INT     NOT NULL GENERATED ALWAYS AS IDENTITY,
  co_seq_dim_equipe         INT     NOT NULL,
  co_seq_dim_unidade_saude  INT     NOT NULL,
  ativ_desativ              boolean NOT NULL,
  cmpt_cnes                 date   ,
  PRIMARY KEY (co_seq_fat_unidade_equipe)
);

COMMENT ON TABLE tb_fat_unidade_equipe IS 'relacionamento entre unidade e equipe';

ALTER TABLE tb_fat_equipe_profissional
  ADD CONSTRAINT FK_tb_dim_profissional_TO_tb_fat_equipe_profissional
    FOREIGN KEY (co_seq_dim_profissional)
    REFERENCES tb_dim_profissional (co_seq_dim_profissional);

ALTER TABLE tb_fat_equipe_profissional
  ADD CONSTRAINT FK_tb_dim_equipe_TO_tb_fat_equipe_profissional
    FOREIGN KEY (co_seq_dim_equipe)
    REFERENCES tb_dim_equipe (co_seq_dim_equipe);

ALTER TABLE tb_fat_unidade_equipe
  ADD CONSTRAINT FK_tb_dim_equipe_TO_tb_fat_unidade_equipe
    FOREIGN KEY (co_seq_dim_equipe)
    REFERENCES tb_dim_equipe (co_seq_dim_equipe);

ALTER TABLE tb_fat_unidade_equipe
  ADD CONSTRAINT FK_tb_dim_unidade_TO_tb_fat_unidade_equipe
    FOREIGN KEY (co_seq_dim_unidade_saude)
    REFERENCES tb_dim_unidade (co_seq_dim_unidade_saude);
